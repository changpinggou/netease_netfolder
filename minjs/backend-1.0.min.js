var PageNavigate=function(a){this.Protocal="http://";this.Domain="nf.mail.163.com";this.path="/netfolder/web/list.do";this.ReqUrl="http://nf.mail.163.com/netfolder/web/list.do";this.formUploadUrl="form.jsp";this.userName=GE.userName;this.sid=gSid||"EBkkkoMMYoHZOEcxvzMMxsRKtYYVdFub";this.getFiles=1;this.getShareInfo=1;this.nextStart="-";this.pageIndex=0;this.pageSize=gPageSize||20;this.pagesCount=1;this.orderBy=0;this.desc=0;this.dirId=a.dirId||-1;this.curPage=a.curPage;this.totalPage=a.totalPage;this.clientData=a.clientData;};PageNavigate.prototype.PageParam=function(){var a=NETEASE_Url.encode(Base64.encode(jQuery.toJSON(this.clientData)));var b="?uid="+this.userName+"&id="+this.dirId+"&getFiles="+this.getFiles+"&getShareInfo="+this.getShareInfo+"&nextStart="+this.nextStart+"&pageIndex="+this.pageIndex+"&pageSize="+this.pageSize+"&pagesCount="+this.pagesCount+"&orderBy="+this.orderBy+"&desc="+this.desc+"&clientData="+a+"&sid="+gSid+"&uid="+gUserName+"&host="+gMasterHost+"&style="+gStyle+"&skin="+gSkin+"&color="+gColor;return b;};PageNavigate.prototype.FormUploadParam=function(){return"?sid="+this.sid+"&fid="+this.dirId;};PageNavigate.prototype.navigateToPre=function(){if(this.curPage===1){return;}this.pageIndex=this.curPage-2;window.location.href=this.ReqUrl+this.PageParam();};PageNavigate.prototype.navigateToFirst=function(){if(this.curPage===1){return;}this.pageIndex=0;window.location.href=this.ReqUrl+this.PageParam();};PageNavigate.prototype.navigateToLast=function(){if(this.curPage===this.totalPage){return;}this.pageIndex=this.totalPage-1;window.location.href=this.ReqUrl+this.PageParam();};PageNavigate.prototype.navigateToNext=function(){if(this.curPage===this.totalPage){return;}this.pageIndex=this.curPage;window.location.href=this.ReqUrl+this.PageParam();};PageNavigate.prototype.navigateBySort=function(a,b){if(a<0||a>4||b<0||b>1){return;}this.orderBy=a;this.desc=b;window.location.href=this.ReqUrl+this.PageParam();};PageNavigate.prototype.navigateToIndex=function(a){if((a<1)||a>this.totalPage){return;}this.pageIndex=a-1;window.location.href=this.ReqUrl+this.PageParam();};PageNavigate.prototype.RefreshPage=function(){window.location.href=this.ReqUrl+this.PageParam();};PageNavigate.prototype.navigateToFormUpload=function(){window.location.href=this.formUploadUrl+this.FormUploadParam();};PageNavigate.prototype.navigateToDir=function(b,a){this.dirId=b?b:-1;if(a!==undefined){this.clientData.pathStack.push({id:b,dirName:a});}window.location.href=this.ReqUrl+this.PageParam();};PageNavigate.prototype.navigateBack=function(){window.history.back(-1);};PageNavigate.prototype.navigateParentDir=function(){if(clientdata.pathStack&&clientdata.pathStack.length>1){clientdata.pathStack.pop();var a=clientdata.pathStack[clientdata.pathStack.length-1];this.dirId=a.id||-1;window.location.href=this.ReqUrl+this.PageParam();}};PageNavigate.prototype.SetShowMode=function(a){this.clientData.showMode=a;};PageNavigate.prototype.pushPathStack=function(a){this.clientData.pathStack.push(a);};PageNavigate.prototype.popPathStack=function(){return this.clientData.pathStack.pop();};PageNavigate.prototype.setPathStack=function(a){if(a&&(a.length>1)){this.clientData.pathStack=a;}};PageNavigate.prototype.setDirID=function(a){this.dirId=a;};PageNavigate.prototype.getDirInfoOnly=function(a){if(a===true){this.getFiles=0;}else{this.getFiles=1;}};PageNavigate.prototype.getShareInfo=function(a){if(a===true){this.getShareInfo=1;}else{this.getShareInfo=0;}};PageNavigate.prototype.setNextStart=function(a){this.nextStart=a;};var NFAjaxInterface=function(a){this.protocal="http://";this.path="/netfolder/service";this.nfhost="http://nf.mail.163.com";this.username=GE.userName;this.sid=a.sid;this.domain="163.com";this.product=a.productName;this.NFAjaxProxy=function(g,e,d,f,c){var b;jQuery.ajax({cache:false,async:(c!==undefined)?c:true,url:this.nfhost+"/netfolder/service?op="+g+"&product="+this.product+"&uid="+this.username+(e?e:""),beforeSend:function(h){},type:(d!==undefined)?"POST":"GET",data:d,dataType:"json",success:function(h){b=h;},complete:function(){f&&f(b);}});};};NFAjaxInterface.prototype.DelFiles=function(a,b){this.NFAjaxProxy("delFiles",undefined,{id:a},function(d){var c={type:"error"};if(d&&d.code){if(d.code===200){c.type="OK";}c.data=d;}CompleteCall(b,c);});};NFAjaxInterface.prototype.DelFolders=function(c,e,a,b,f){var d={id:c,recursive:e,checkIfEmpty:a,reserveStructure:b};this.NFAjaxProxy("delDirs",undefined,d,function(h){var g={type:"error"};if(h&&h.code){if(h.code===200){g.type="OK";}g.data=h;}CompleteCall(f,g);});};NFAjaxInterface.prototype.ShareFile=function(b,c){var a={id:b};this.NFAjaxProxy("shareFile",undefined,a,function(e){var d={type:"error"};if(e&&e.code){if(e.code===200){d.type="ok";}d.data=e;}CompleteCall(c,d);},false);};NFAjaxInterface.prototype.RemoveFileShare=function(c,b,d){var a={fileId:c,id:b};this.NFAjaxProxy("cancelFileShare",undefined,a,function(f){var e={type:"error"};if(f&&f.code){if(f.code===200){e.type="OK";}e.data=f;}CompleteCall(d,e);},false);};NFAjaxInterface.prototype.MoveItems=function(b,e,g){var c=b.folder;var f=b.file;var a={file:{type:"error"},folder:{type:"error"}};if(f.length>0){var d={id:f,dirId:e,nameConflictPolicy:0,renamePolicy:0};this.NFAjaxProxy("moveFiles",undefined,d,BindThis(this,function(h){if(h&&h.code){if(h.code===200){a.file.type="OK";}a.file.data=h;}d.id=c;if(c.length>0){this.NFAjaxProxy("moveDirs",undefined,d,function(i){if(i&&i.code){if(i.code===200){a.folder.type="OK";}a.folder.data=i;}CompleteCall(g,a);});}else{a.folder.type="OK";CompleteCall(g,a);}}));}else{a.file.type="OK";this.NFAjaxProxy("moveDirs",undefined,d,function(h){if(h&&h.code){if(h.code===200){a.folder.type="OK";}a.folder.data=h;}CompleteCall(g,a);});}};NFAjaxInterface.prototype.UpdateFile=function(a,c,d){var b="id="+a+"&file="+jQuery.toJSON(c)+"&nameConflictPolicy=0&renamePolicy=1";this.NFAjaxProxy("updateFile",undefined,b,function(f){var e={type:"error"};if(f&&f.code){if(f.code===200){e.type="OK";}e.data=f;}CompleteCall(d,e);});};NFAjaxInterface.prototype.UpdateFolder=function(d,b,c){var a="id="+d+"&dir="+jQuery.toJSON(b)+"&nameConflictPolicy=0&renamePolicy=1";this.NFAjaxProxy("updateDir",undefined,a,function(f){var e={type:"error"};if(f&&f.code){if(f.code===200){e.type="OK";}e.data=f;}CompleteCall(c,e);});};NFAjaxInterface.prototype.PreviewFile=function(b,a){this.GetFileCert(b,a);};NFAjaxInterface.prototype.GetDirStructure=function(d,a,b,c,f){if((a===undefined)||(b===undefined)||(c===undefined)){return;}var e="&id="+d+"&recursive="+a+"&returnInfo="+b+"&countFiles="+c;this.NFAjaxProxy("getDirStructure",e,undefined,function(h){var g={type:"error"};if(h&&h.code){if(h.code===200){g.type="OK";}g.data=h;}CompleteCall(f,g);});};NFAjaxInterface.prototype.CreateDir=function(a,b,d){var c={dir:jQuery.toJSON({dirName:b,parentId:a,description:""}),nameConflictPolicy:0,renamePolicy:1};this.NFAjaxProxy("createDir",undefined,c,function(f){var e={type:"error",desc:""};if(f&&f.code){if(f.code===200){e.type="OK";}e.data=f;}e.desc=GE.commonErrorCode[f.code].description;CompleteCall(d,e);});};NFAjaxInterface.prototype.GetFileCert=function(d,c,b){var a={uid:this.username,id:d};this.NFAjaxProxy("getDownloadCert",undefined,a,function(f){var e={type:"error",desc:""};if(f&&f.code){if(f.code===200){e.type="OK";e.id=d;e.docURL=f.result.token.docURL;CompleteCall(c,e);}else{e.desc=GE.commonErrorCode[f.code].description;CompleteCall(c,e);}}},b);};NFAjaxInterface.prototype.GetFileCertSet=function(c,d,b){var a={uid:this.username,id:c};this.NFAjaxProxy("getDownloadCertSet",undefined,a,function(f){var e={type:"error",desc:""};if(f&&f.code){if(f.code===200){e.type="OK";e.certs=f.result.cert;CompleteCall(d,e);}else{e.desc=GE.commonErrorCode[f.code].description;CompleteCall(d,e);}}},b);};NFAjaxInterface.prototype.GetMiscJs=function(b,c){var a={type:"error"};jQuery.get(b,[],function(d,e){if(e==="success"){a.type="OK";a.data=d;}CompleteCall(c,a);},"javascript");};NFAjaxInterface.prototype.ShareFileSet=function(b,c){var a={id:b};this.NFAjaxProxy("shareFileSet",undefined,a,function(e){var d={type:"error"};if(e&&e.code){if(e.code===200){d.type="OK";}d.data=e;}CompleteCall(c,d);},false);};NFAjaxInterface.prototype.DownLoadFile=function(b,a){this.GetFileCert(b,a);};NFAjaxInterface.prototype.ZipDownLoadItems=function(d,a,c){var b={uid:this.username,dirId:a,fileId:d};this.NFAjaxProxy("getZipDownloadCert",undefined,b,BindThis(this,function(f){var e={type:"error",desc:""};if(f&&f.code){if(f.code===200){e.type="OK";e.docURL=f.result.token.docURL;CompleteCall(c,e);}else{e.desc=GE.commonErrorCode[f.code].description;CompleteCall(c,e);}}}));};NFAjaxInterface.prototype.GetUserInfo=function(a,c){var b="&uid="+a;this.NFAjaxProxy("getUser",b,undefined,BindThis(this,function(e){var d={type:"error",desc:""};if(e&&e.code){if(e.code===200){d.type="OK";d.data=e;CompleteCall(c,d);}else{d.desc=GE.commonErrorCode[e.code].description;CompleteCall(c,d);}}}));};var DocSet=function(i){this.folders={};this.files={};var d={};var a={};this.dirid=i;this.list_mode_dom=undefined;this.pic_mode_dom=undefined;var e={};var f="dateAsc";var j=0;var c=0;var h=this;var b=function(k){return false;};var g=function(k){if(f===k){if(e[k]===undefined){e[k]=[];for(var l in h.folders){e[k].push(l);}for(var l in h.files){e[k].push(l);}}return;}if(e[f]===undefined){}f=k;};h.RenderList=function(l,m){g(m);var n=e[f];for(var k=0;k<n.length;k++){this.folders[n[k]]?l.append(h.folders[n[k]].list_mode_dom):l.append(h.files[n[k]].list_mode_dom);}};h.RenderPicList=function(l,m){g(m);var n=e[f];for(var k=0;k<n.length;k++){this.folders[n[k]]?l.append(h.folders[n[k]].pic_mode_dom):l.append(h.files[n[k]].pic_mode_dom);}};h.SelectAllItems=function(l){for(var k in this.folders){d[k]=l;}for(var k in this.files){a[k]=l;}};h.OnSelFolder=function(l,k){d[l]=k;};h.OnSelFile=function(l,k){a[l]=k;};h.OnSelItem=function(m,l){for(var k in this.folders){if(k==m){d[k]=l;return;}}for(var k in this.files){if(k==m){a[k]=l;return;}}};h.GetCount=function(){return count;};h.JifenToDltimes=function(l,k){};h.GetFileFromId=function(k){return h.files[k];};h.GetFolderFromId=function(k){return h.folders[k];};h.AddFolders=function(k){if(!k||!k[0]){return;}for(var l=0;l<k.length;l++){if(h.folders[k[l].id]!==undefined){continue;}h.folders[k[l].id]=k[l];c++;}};h.AddFiles=function(l){if(!l||!l[0]){return;}for(var k=0;k<l.length;k++){if(h.files[l[k].id]!==undefined){continue;}h.files[l[k].id]=l[k];j++;}};h.RenameFile=function(m,l,k){this.files[m]&&(this.files[m].fileName=l);this.files[m]&&(this.files[m].description=k);};h.RenameFolder=function(m,l,k){this.folders[m]&&(this.folders[m].dirName=l);this.folders[m]&&(this.folders[m].description=k);};h.GetAllCheckItems=function(){var m=[];var k=[];for(var l in d){if(d[l]===true){m.push(l);}}for(var l in a){if(a[l]===true){k.push(l);}}return{folder:m,file:k};};h.GetAllItemsCnt=function(){return j+c;};h.GetCheckItemsCnt=function(){var l=0;for(var k in d){if(d[k]===true){l++;}}for(var k in a){if(a[k]===true){l++;}}return l;};h.ZipDownload=function(){var l=h.GetAllCheckItems();for(var k=0;k<l.file.length;k++){if(b(l.file[k])){fCommonMsgBox({title:"下载文件出错",content:"你选择了未上传完成的文件，不能下载。"});return;}}if(l.folder.length==0&&l.file.length==1){location.href=gDownloadUrl+"&mid="+l.file[0];}else{if(l.folder.length>0||l.file.length>0){fWpPackDown(l);}else{fCommonMsgBox({title:"下载文件出错",content:"请选择你需要下载的文件或文件夹。"});}}};h.Remove=function(k){if(h.docs[k]===undefined){return;}if(doc.type==="file"){files.Remove(doc.id);}else{folders.Remove(doc.id);}delete h.docs[k];h.count--;};h.Edit=function(k){if(h.docs[k.id]===undefined){return;}h.docs[k.id]=k;};h.Reset=function(){h.docs={};folders.Reset();files.Reset();h.count=0;};};